# =======================
# .htaccess — Burry Soprano
# =======================

# ---- Temel sert ayarlar ----
Options -Indexes
ServerSignature Off
FileETag None

# ---- Tek adımda HTTPS + non-www ----
# http://*, https://www.*  ->  https://burrysoprano.com/...
RewriteEngine On
RewriteCond %{HTTPS} !=on [OR]
RewriteCond %{HTTP_HOST} !^burrysoprano\.com$ [NC]
RewriteRule ^ https://burrysoprano.com%{REQUEST_URI} [R=301,L]

# ---- Kısa URL yönlendirmeleri ----
Redirect 301 /spotify    https://open.spotify.com/intl-tr/artist/5SpHQasdZkIx2RFJzvBBsD
Redirect 301 /apple      https://music.apple.com/tr/artist/burry-soprano/1040539426
Redirect 301 /youtube    https://music.youtube.com/channel/UCYuGjWAk9GZKeuc6EzTUa9w
Redirect 301 /deezer     https://www.deezer.com/tr/artist/49530532
Redirect 301 /tidal      https://tidal.com/browse/artist/10168023
Redirect 301 /amazon     https://music.amazon.com/artists/B07G4KYTS7/burry-soprano
Redirect 301 /soundcloud https://soundcloud.com/burrysoprano
Redirect 301 /applemusic https://music.apple.com/tr/artist/burry-soprano/1040539426

# ---- Özel hata sayfası ----
ErrorDocument 404 /404.html
#ErrorDocument 404 /index.html

# ---- Güvenlik başlıkları ----
# Spotify embed ve GA (onaydan sonra) izinli olacak şekilde CSP
Header always set Content-Security-Policy "default-src 'self'; base-uri 'self'; object-src 'none'; frame-ancestors 'self'; upgrade-insecure-requests; frame-src https://open.spotify.com; img-src 'self' data: https://is1-ssl.mzstatic.com https://i.scdn.co https://www.google-analytics.com; script-src 'self' 'unsafe-inline' https://www.googletagmanager.com https://www.google-analytics.com; style-src 'self' 'unsafe-inline'; font-src 'self' data:; connect-src 'self' https://www.google-analytics.com"
Header always set X-Content-Type-Options "nosniff"
Header always set Referrer-Policy "strict-origin-when-cross-origin"
Header always set Permissions-Policy "camera=(), microphone=(), geolocation=()"
# CSP zaten çerçevelemeyi sınırlar; yine de:
Header always set X-Frame-Options "SAMEORIGIN"

# ---- HSTS (yalnızca HTTPS tam oturduysa aç) ----
# İlk deployda sorun olmasın diye açık bırakıyorum; emin değilsen max-age'i düşürebilirsin.
Header always set Strict-Transport-Security "max-age=31536000; includeSubDomains; preload"

# ---- Sıkıştırma ----
<IfModule mod_brotli.c>
  AddOutputFilterByType BROTLI_COMPRESS text/plain text/html text/xml text/css text/javascript application/javascript application/json application/xml image/svg+xml
</IfModule>
<IfModule mod_deflate.c>
  AddOutputFilterByType DEFLATE text/plain text/html text/xml text/css text/javascript application/javascript application/json application/xml image/svg+xml
</IfModule>

# ---- Cache kontrol ----
<IfModule mod_expires.c>
  ExpiresActive On
  ExpiresByType text/css                           "access plus 30 days"
  ExpiresByType application/javascript             "access plus 30 days"
  ExpiresByType text/javascript                    "access plus 30 days"
  ExpiresByType image/svg+xml                      "access plus 30 days"
  ExpiresByType image/webp                         "access plus 30 days"
  ExpiresByType image/png                          "access plus 30 days"
  ExpiresByType image/jpeg                         "access plus 30 days"
  ExpiresByType image/gif                          "access plus 30 days"
  ExpiresDefault                                   "access plus 7 days"
</IfModule>

# Uzun cache + immutable
<FilesMatch "\.(js|css|png|jpe?g|gif|svg|webp|woff2?)$">
  Header set Cache-Control "public, max-age=2592000, immutable"
</FilesMatch>

# HTML kısa cache (içerik hızlı değişebilir)
<FilesMatch "\.(html?)$">
  Header set Cache-Control "public, max-age=300"
</FilesMatch>
